<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/public.css" media="all">
</head>

<body>
    <div class="layuimini-container">
        <div class="layuimini-main">

            <fieldset class="table-search-fieldset">
                <legend>订单详细</legend>
                <script type="text/html" id="toolbarDemo">

                </script>

                <table class="layui-hide" id="currentTableId" lay-filter="currentTableFilter"></table>

                <script type="text/html" id="currentTableBar">
                    <a class="layui-btn layui-btn-xs layui-btn-danger data-count-delete" lay-event="delete">删除</a>
                </script>
            </fieldset>


            <fieldset class="table-search-fieldset">
                <legend>添加路径</legend>
                <div class="layui-form layuimini-form">
                    <div class="layui-form-item">
                        <label class="layui-form-label required">任务单号</label>
                        <!-- <div class="layui-input-block">
                            <input type="text" name="orderID" lay-verify="required" lay-reqtext="请输入单号"
                                placeholder="请输入单号" value="00001" class="layui-input" disabled="disabled">
                        </div> -->
                        <div class="layui-input-block">
                            <input type="text" name="orderID" lay-verify="required" lay-reqtext="请输入单号"
                                placeholder="请输入单号" value="00001" class="layui-input">
                        </div>
                    </div>
                    <!-- <div class="layui-form-item">
                        <label class="layui-form-label required">夹具序号</label>
                        <div class="layui-input-block">
                            <input type="radio" name="fixtureID" value="夹具1" title="夹具1" checked="">
                            <input type="radio" name="fixtureID" value="夹具2" title="夹具2">
                            <input type="radio" name="fixtureID" value="夹具3" title="夹具3">
                            <input type="radio" name="fixtureID" value="夹具4" title="夹具4">
                            <input type="radio" name="fixtureID" value="夹具5" title="夹具5">
                            <input type="radio" name="fixtureID" value="夹具6" title="夹具6">
                            <input type="radio" name="fixtureID" value="夹具7" title="夹具7">
                            <input type="radio" name="fixtureID" value="夹具8" title="夹具8">
                            <input type="radio" name="fixtureID" value="夹具9" title="夹具9">
                            <input type="radio" name="fixtureID" value="夹具10" title="夹具10">
                        </div>
                    </div> -->
                    <div class="layui-form-item">
                        <label class="layui-form-label required">托盘序号</label>
                        <div class="layui-input-inline">
                            <input type="text" name="palletID" placeholder="请输入" autocomplete="off" class="layui-input"
                                id="demo1" value="" ts-selected="">
                        </div>
                        <div class="layui-form-mid layui-word-aux">从托盘库选择托盘</div>
                    </div>
                    <!-- "orderID": "00001",
                    "fixtureID": "M0001",
                    "loadID": "1",
                    "unloadID": "2",
                    "machineID": "A",
                    "technology": "T1",
                    "totalWorkpieceNum": "5", -->
                    <div class="layui-form-item">
                        <label class="layui-form-label required">夹具1</label>
                        <div class="layui-input-inline">
                            <input type="text" name="fixture1Num" placeholder="请输入" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">夹具2</label>
                        <div class="layui-input-inline">
                            <input type="text" name="fixture2Num" placeholder="请输入" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">夹具3</label>
                        <div class="layui-input-inline">
                            <input type="text" name="fixture3Num" placeholder="请输入" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">夹具4</label>
                        <div class="layui-input-inline">
                            <input type="text" name="fixture4Num" placeholder="请输入" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">装载编号</label>
          
                        <div class="layui-input-block">
                            <input type="radio" name="loadID" value="1" title="L/UL1" checked="">
                            <input type="radio" name="loadID" value="2" title="L/UL2">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">装载时间</label>
                        <div class="layui-input-inline">
                            <input type="text" name="loadTime" placeholder="请输入" class="layui-input">
                        </div>
                        <div class="layui-form-mid layui-word-aux">单位是min</div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">机床编号</label>
                        <!-- <div class="layui-input-block">
                        <input type="radio" name="jc" value="MC1" title="MC1" checked="">
                        <input type="radio" name="jc" value="MC2" title="MC2">
                        <input type="radio" name="jc" value="MC3" title="MC3">
                    </div> -->
                        <div class="layui-input-block">
                            <input type="checkbox" name="machineID" value="A" title="MC1" checked="">
                            <input type="checkbox" name="machineID" value="B" title="MC2">
                            <input type="checkbox" name="machineID" value="C" title="MC3">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">工艺序号</label>
                        <div class="layui-input-inline">
                            <input type="text" name="processID" placeholder="请输入" autocomplete="off" class="layui-input"
                                id="demo" value="" ts-selected="">
                        </div>
                        <div class="layui-form-mid layui-word-aux">选择多个工序</div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">加工时间</label>
                        <div class="layui-input-inline">
                            <input type="text" name="processTime" placeholder="请输入" class="layui-input">
                        </div>
                        <div class="layui-form-mid layui-word-aux">单位是min</div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">卸载编号</label>
                        <div class="layui-input-block">
                            <input type="radio" name="unloadID" value="1" title="L/UL1" checked="">
                            <input type="radio" name="unloadID" value="2" title="L/UL2">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">卸载时间</label>
                        <div class="layui-input-inline">
                            <input type="text" name="unloadTime" placeholder="请输入" class="layui-input">
                        </div>
                        <div class="layui-form-mid layui-word-aux">单位是min</div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label required">工件数</label>
                        <div class="layui-input-block">
                            <input type="text" name="loopNum" lay-verify="required" lay-reqtext="输入工件数"
                                placeholder="请输入工件数" value="1" class="layui-input">
                        </div>
                    </div>
                    <!-- <div class="layui-form-item">
                        <label class="layui-form-label">启用状态</label>
                        <div class="layui-input-block">
                            <input type="checkbox" checked="" name="open" lay-skin="switch" lay-filter="switchTest"
                                lay-text="开|关">
                        </div>
                    </div> -->
                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <button class="layui-btn" lay-submit lay-filter="saveBtn">确认创建路径</button>
                            <button class="layui-btn" lay-submit lay-filter="saveBtn1">更新表单数据</button>
                        </div>
                    </div>
                </div>
            </fieldset>
        </div>
    </div>
    <script src="../../lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
    <script src="../../js/lay-config.js?v=1.0.4" charset="utf-8"></script>
    <script src="../../lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
    <script>

        var data1 = [
            // {
            //     "orderID": "00001",
            //     "fixtureID": "M0001",
            //     "loadID": "1",
            //     "unloadID": "2",
            //     "machineID": "A",
            //     "technology": "T1",
            //     "totalWorkpieceNum": "5",
            // }
        ]

        layui.use(['form', 'table', 'laydate'], function () {
            var $ = layui.jquery,
                form = layui.form,
                table = layui.table,
                layuimini = layui.layuimini,
                laydate = layui.laydate;

            laydate.render({
                elem: '#date1'
                , type: 'datetime'
                , range: '~' //或 range: '~' 来自定义分割字符
            });
            table.render({
                elem: '#currentTableId',
                // url: JSON.parse(data),
                totalRow: true,
                cols: [[
                    // "orderID": "00001",
                    //     "fixtureID": "M0001",
                    //     "loadID": "1",
                    //     "unloadID": "2",
                    //     "machineID": "A",
                    //     "technology": "T1",
                    { field: 'orderID', width: 90, title: 'ERP单号', totalRowText: '合计行' },
                    { field: 'palletID', width: 85, title: '托盘号' },
                    { field: 'fixture1Num', width: 70, title: '夹具1' },
                    { field: 'fixture2Num', width: 70, title: '夹具2' },
                    { field: 'fixture3Num', width: 70, title: '夹具3' },
                    { field: 'fixture4Num', width: 70, title: '夹具4' },
                    {
                        field: 'loadID', width: 60, title: '装载', templet: function (d) {
                            return d.loadID == '1' ? "L\UL1" : "L\UL2";
                        }
                    },
                    { field: 'loadTime', width: 86, title: '装载时间' },
                    {
                        field: 'unloadID', width: 60, title: '卸载', templet: function (d) {
                            return d.unloadID == '1' ? "L\UL1" : "L\UL2";
                        }
                    },
                    { field: 'unloadTime', width: 86, title: '卸载时间' },
                    {
                        field: 'machineID', width: 93, title: '加工机床', templet: function (d) {
                            return d.machineID == 'A' ? "MC1" : d.machineID == 'B' ? "MC2" : "MC3";
                        }
                    },
                    { field: 'processTime', width: 86, title: '加工时间' },
                    {
                        field: 'processID', width: 80, title: '工艺',
                        // templet: function (d) {
                        //     return d.userStatus == '0' ? "正常使用" : "<span class='layui-red'>限制使用</span>";
                        // }
                    },
                    { field: 'loopNum', width: 60, title: '工件数', totalRow: true },
                    { title: '操作', minWidth: 60, templet: '#currentTableBar', fixed: "right", align: "center" }
                ]],
                data: data1

                // limit: 10,
                // page: true
            });

            // 监听搜索操作
            form.on('submit(data-search-btn)', function (data) {
                var result = JSON.stringify(data.field);
                layer.alert(result, {
                    title: '最终的搜索信息'
                });

                //执行搜索重载
                table.reload('currentTableId', {
                    page: {
                        curr: 1
                    }
                    , where: {
                        searchParams: result
                    }
                }, 'data');

                return false;
            });

            // 监听添加操作
            $(".data-add-btn").on("click", function () {

                var index = layer.open({
                    title: '创建托盘任务表',
                    type: 2,
                    shade: 0.2,
                    maxmin: true,
                    shadeClose: true,
                    area: ['100%', '100%'],
                    content: '/page/table/moni.html',
                });
                $(window).on("resize", function () {
                    layer.full(index);
                });

                return false;
            });

            // 监听删除操作
            $(".data-delete-btn").on("click", function () {
                var checkStatus = table.checkStatus('currentTableId')
                    , data = checkStatus.data;
                layer.alert(JSON.stringify(data));
            });

            //监听表格复选框选择
            table.on('checkbox(currentTableFilter)', function (obj) {
                console.log(obj)
            });

            table.on('tool(currentTableFilter)', function (obj) {
                var data = obj.data;
                if (obj.event === 'edit') {
                    var index = layer.open({
                        title: '单据托盘任务表',
                        type: 2,
                        shade: 0.2,
                        maxmin: true,
                        shadeClose: true,
                        area: ['100%', '100%'],
                        content: '/page/table/moni.html',
                    });
                    $(window).on("resize", function () {
                        layer.full(index);
                    });
                    return false;
                } else if (obj.event === 'gantt') {

                    var index = layer.open({
                        title: '任务单号:' + data.id,
                        type: 2,
                        shade: 0.2,
                        maxmin: true,
                        shadeClose: true,
                        area: ['100%', '100%'],
                        content: '/page/table/gantt.html',
                    });
                    $(window).on("resize", function () {
                        layer.full(index);
                    });
                    return false;
                } else if (obj.event === 'delete') {
                    layer.confirm('真的删除行么', function (index) {
                        console.log(index)
                        obj.del();
                        layer.close(index);
                    });
                }
            });

        });
    </script>
    <script>
        layui.use(['table', 'form', 'tableSelect'], function () {
            var $ = layui.jquery,
                table = layui.table,
                form = layui.form,
                tableSelect = layui.tableSelect;

            tableSelect.render({
                elem: '#demo',
                searchKey: 'my',
                checkedKey: 'id',
                // searchPlaceholder: '',
                table: {
                    url: '../../api/tableSelect.json',
                    cols: [[
                        { type: 'checkbox' },
                        { field: 'id2', title: '序号', width: 100 },
                        // { field: 'id1', title: '设备型号', width: 100 },
                        { field: 'username', title: '工序名称', width: 300 },
                        { field: 'min', title: '节拍', width: 100 }
                    ]]
                },
                done: function (elem, data) {
                    var NEWJSON = []
                    layui.each(data.data, function (index, item) {
                        // NEWJSON.push(item.id1 + ":" + item.id)
                        NEWJSON.push(item.id2)
                    })
                    elem.val(NEWJSON.join(","))
                }
            })
            tableSelect.render({
                elem: '#demo1',
                searchKey: 'my',
                checkedKey: 'id',
                // searchPlaceholder: '',
                table: {
                    url: '../../api/JiaJu.json',
                    cols: [[
                        { type: 'radio' },
                        { field: 'id1', title: '夹具', width: 150 },
                        { field: 'id2', title: '型号', width: 150 },
                        { field: 'id3', title: '规格', width: 150 },
                    ]]
                },
                done: function (elem, data) {
                    var NEWJSON = []
                    layui.each(data.data, function (index, item) {
                        NEWJSON.push(item.id1)
                    })
                    elem.val(NEWJSON.join(","))
                }
            })
            //监听提交
            form.on('submit(saveBtn)', function (data) {
                var index = layer.alert(JSON.stringify(data.field), {
                    title: '最终的提交信息'
                }, function () {
                    data1[data1.length] = data.field
                    // 关闭弹出层
                    layer.close(index);
                    table.reload('currentTableId', {
                        data: data1
                    });
                    // parseInt(JSON.stringify(data.field))
                    console.log(data.field)
                    console.log(JSON.stringify(data.field).split('"'))
                    console.log(data1)
                    console.log(layui.table.cache["currentTableId"])
                    // layui.form.render();
                    // var iframeIndex = parent.layer.getFrameIndex(window.name);
                    // parent.layer.close(iframeIndex);
                    // currentTableId.reload({
                    //     data:data1 
                    // })
                });
                return false;
            });
            //监听提交
            form.on('submit(saveBtn1)', function (data) {
                var index = layer.alert("是否提交所有路径数据至ERP订单内？", {
                    title: '提交确认框'
                }, function () {
                    // 关闭弹出层
                    layer.close(index);
                    var iframeIndex = parent.layer.getFrameIndex(window.name);
                    parent.layer.close(iframeIndex);
                    console.log(layui.table.cache["currentTableId"])
                    $.ajax({
                        type: "POST",
                        // contentType: "application/json;charset=UTF-8",
                        url: "http://192.168.0.111:8080/addPalletOrder",
                        data: JSON.stringify(layui.table.cache["currentTableId"]),
                        success: function (result) {
                            console.log(result);
                        },
                        //请求失败，包含具体的错误信息
                        error: function (e) {
                            console.log(e.status);
                            console.log(e.responseText);
                        }
                    });
                });
                return false;
            });
        });
    </script>
</body>

</html>